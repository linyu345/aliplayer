<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
    <title>Aliplay记忆播放器（点播） - 纯 HTML 版</title>
    <!-- Aliplayer 样式 -->
    <link rel="stylesheet" href="https://g.alicdn.com/de/prismplayer/2.9.3/skins/default/aliplayer-min.css" />
    <!-- Aliplayer 脚本 -->
    <script type="text/javascript" charset="utf-8" src="https://g.alicdn.com/de/prismplayer/2.9.3/aliplayer-min.js"></script>
    <script type="text/javascript" charset="utf-8" src="https://player.alicdn.com/aliplayer/presentation/js/aliplayercomponents.min.js"></script>
    <style type="text/css">
        html, body {
            width:100%;
            height:100%;
            background:#000;
            padding:0;
            margin:0;
            overflow:hidden;
        }
        * {
            box-sizing: border-box;
            margin:0;
            padding:0;
            border:0;
            text-decoration:none;
        }
        #noSourceMsg {
            color: #fff;
            font-family: Arial, "Microsoft Yahei", sans-serif;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%,-50%);
            text-align: center;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="playerCnt" class="prism-player" style="width:100%;height:100%;"></div>
    <div id="noSourceMsg" style="display:none;">
        <div style="font-size:18px;margin-bottom:8px;">未检测到视频源</div>
        <div style="font-size:13px;opacity:0.8;">请在地址栏添加 ?url= 视频地址（支持 http(s) 链接）</div>
        <div style="font-size:12px;opacity:0.6;margin-top:10px;">示例： index.html?url=https%3A%2F%2Fexample.com%2Fvideo.mp4</div>
    </div>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            var params = new URLSearchParams(window.location.search);
            var sourceParam = params.get('url') || '';
            try {
                sourceParam = decodeURIComponent(sourceParam);
            } catch (e) {}

            var isValidSource = false;
            if (sourceParam) {
                var low = sourceParam.trim().toLowerCase();
                if (low.startsWith('http://') || low.startsWith('https://')) {
                    isValidSource = true;
                }
            }

            var noSourceMsg = document.getElementById('noSourceMsg');
            if (!isValidSource) {
                noSourceMsg.style.display = 'block';
                document.getElementById('playerCnt').style.display = 'none';
                return;
            }

            try {
                var player = new Aliplayer({
                    id: "playerCnt",
                    source: sourceParam,
                    width: "100%",
                    height: "100%",
                    autoplay: true,
                    preload: true,
                    rePlay: false,
                    playsinline: false,
                    useH5Prism: false,
                    isLive: false,
                    volume: 0,  // 默认静音
                    components: [{
                        name: 'MemoryPlayComponent',
                        type: AliPlayerComponent.MemoryPlayComponent,
                        args: [true]
                    }]
                }, function (player) {
                    console.log("Aliplayer 已创建，source:", sourceParam);
                    player.setVolume(0);  // 再次强制静音，确保生效
                });

            } catch (err) {
                console.error('创建播放器时出错：', err);
                noSourceMsg.style.display = 'block';
                noSourceMsg.innerText = '播放器初始化失败，请检查控制台错误信息。';
            }
        });
    </script>
</body>
</html>
